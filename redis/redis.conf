# Redis 7.x Configuration File

################################## NETWORK #####################################

# Accept connections on the specified port, default is 6379
port 6379

# By default, if no "bind" configuration directive is specified, Redis listens
# for connections from all available network interfaces
bind 0.0.0.0

# Protected mode is enabled by default. You should disable it only if
# you are sure you want clients from other hosts to connect to Redis
protected-mode yes

# TCP listen() backlog
tcp-backlog 511

# Close the connection after a client is idle for N seconds (0 to disable)
timeout 0

# TCP keepalive
tcp-keepalive 300

################################# GENERAL #####################################

# By default Redis does not run as a daemon
daemonize no

# Set the number of databases. The default database is DB 0
databases 16

# Show logo on startup
always-show-logo no

################################ SNAPSHOTTING  ################################

# Save the DB to disk
# save <seconds> <changes>
# Will save the DB if both the given number of seconds and the given
# number of write operations against the DB occurred.

save 3600 1
save 300 100
save 60 10000

# Compress string objects using LZF when dump .rdb databases
rdbcompression yes

# Since version 5 of RDB a CRC64 checksum is placed at the end of the file
rdbchecksum yes

# The filename where to dump the DB
dbfilename dump.rdb

# The working directory
dir /data

################################# REPLICATION #################################

# Master-Replica replication settings
replica-serve-stale-data yes
replica-read-only yes

################################## SECURITY ###################################

# Require clients to issue AUTH <PASSWORD> before processing any other commands
requirepass ${REDIS_PASSWORD:-ThisIsAComplicatePassWord}

################################### CLIENTS ####################################

# Set the max number of connected clients at the same time
maxclients 10000

############################## MEMORY MANAGEMENT ################################

# Set a memory usage limit to the specified amount of bytes
# maxmemory <bytes>
maxmemory 2gb

# MAXMEMORY POLICY: how Redis will select what to remove when maxmemory is reached
maxmemory-policy allkeys-lru

# LRU and minimal TTL algorithms are not precise but approximated algorithms
maxmemory-samples 5

############################# LAZY FREEING ####################################

# Redis has two primitives to delete keys
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no

############################ KERNEL OOM CONTROL ##############################

# On Linux, it is possible to hint the kernel OOM killer
oom-score-adj no

#################### KERNEL transparent hugepage CONTROL ######################

################################## AOF持久化 ###################################

# AOF持久化开启
appendonly yes

# AOF文件名称
appendfilename "appendonly.aof"

# AOF同步策略
# always: 每次写入都同步到磁盘，最安全但性能最差
# everysec: 每秒同步一次，推荐使用
# no: 不主动同步，由操作系统决定何时同步
appendfsync everysec

# 当AOF文件增长到原来的100%时触发重写
auto-aof-rewrite-percentage 100

# AOF文件最小重写大小
auto-aof-rewrite-min-size 64mb

# 加载AOF文件时是否忽略不完整的部分
aof-load-truncated yes

# Redis在启动时检查AOF文件是否有末尾不完整命令
aof-rewrite-incremental-fsync yes

################################ LUA SCRIPTING  ###############################

# Max execution time of a Lua script in milliseconds
lua-time-limit 5000

################################## SLOW LOG ###################################

# The Redis Slow Log is a system to log queries that exceeded a specified execution time
slowlog-log-slower-than 10000
slowlog-max-len 128

################################ LATENCY MONITOR ##############################

# The Redis latency monitoring subsystem samples different operations at runtime
latency-monitor-threshold 0

############################# EVENT NOTIFICATION ##############################

# Redis can notify Pub/Sub clients about events happening in the key space
notify-keyspace-events ""

############################### ADVANCED CONFIG ###############################

# Hashes are encoded using a memory efficient data structure
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# Lists are also encoded in a special way to save a lot of space
list-max-ziplist-size -2
list-compress-depth 0

# Sets have a special encoding when composed of just strings that happen to be integers
set-max-intset-entries 512

# Similarly to hashes and lists, sorted sets are also specially encoded
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog sparse representation bytes limit
hll-sparse-max-bytes 3000

# Streams macro node max size / items
stream-node-max-bytes 4096
stream-node-max-entries 100

# Active rehashing uses 1 millisecond every 100 milliseconds of CPU time
activerehashing yes

# The client output buffer limits can be used to force disconnection of clients
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Redis calls an internal function to perform many background tasks
hz 10

# When dynamic HZ is enabled, the actual configured HZ will be used as a baseline
dynamic-hz yes

# When a child rewrites the AOF file, if the following option is enabled
aof-rewrite-incremental-fsync yes

# When redis saves RDB file, if the following option is enabled
rdb-save-incremental-fsync yes

# Redis LFU eviction can be tuned
# lfu-log-factor 10
# lfu-decay-time 1

########################### ACTIVE DEFRAGMENTATION #######################

# Enabled active defragmentation
# activedefrag no

# Jemalloc background thread for purging will be enabled by default
jemalloc-bg-thread yes

# In some cases redis will emit warnings and even refuse to start
# ignore-warnings ARM64-COW-BUG
